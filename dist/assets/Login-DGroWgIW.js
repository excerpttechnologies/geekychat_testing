import{u as q,r as s,j as a,L as j,a as y}from"./index-DvRHxkZp.js";const D=()=>{const i=q(),[d,w]=s.useState(""),[u,S]=s.useState(""),[h,C]=s.useState(""),[N,P]=s.useState(""),[m,g]=s.useState(""),[x,E]=s.useState(""),[o,T]=s.useState("password"),[I,L]=s.useState(!1),[t,r]=s.useState(!1),[p,b]=s.useState(0),[v,F]=s.useState(!1),[O,l]=s.useState(null);s.useEffect(()=>{c()},[]),s.useEffect(()=>{if(p>0){const e=setInterval(()=>b(n=>n-1),1e3);return()=>clearInterval(e)}},[p]);const c=()=>{const e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let n="";for(let f=0;f<6;f++)n+=e[Math.floor(Math.random()*e.length)];E(n),g("")},R=e=>{const n=Math.floor(e/60),f=e%60;return`${n}:${f.toString().padStart(2,"0")}`},k=e=>{T(e),L(!1),P(""),b(0),S(""),w(""),C(""),g(""),c(),l(null)},M=async()=>{if(l(null),!d.trim()){l("Please enter your phone number.");return}if(m.trim().toUpperCase()!==x.toUpperCase()){l("Invalid captcha. Please try again."),c();return}r(!0);try{const e=await y.post("/api/auth/send-otp",{phone:d.trim()});e.data.success&&(L(!0),b(300),alert(e.data.message))}catch(e){alert(e?.response?.data?.message||"Failed to send OTP")}finally{r(!1)}},V=async()=>{l(null),r(!0);try{const e=await y.post("/api/auth/resend-otp",{phone:d.trim()});e.data.success&&(b(300),alert(e.data.message))}catch(e){alert(e?.response?.data?.message||"Failed to resend OTP")}finally{r(!1)}},U=async()=>{if(l(null),!N.trim()){l("Please enter the OTP");return}r(!0);try{const e=await y.post("/api/auth/verify-otp-login",{phone:d.trim(),otp:N.trim()});e.data.success&&(localStorage.setItem("isLoggedIn","true"),localStorage.setItem("role","user"),localStorage.setItem("userPhone",e.data.user.phone),localStorage.setItem("user",JSON.stringify(e.data.user)),e.data.userId&&localStorage.setItem("userId",e.data.userId),alert(e.data.message),e.data.needsVerification?i("/verification"):i("/dashboard"),window.location.reload())}catch(e){alert(e?.response?.data?.message||"OTP verification failed")}finally{r(!1)}},$=async()=>{if(l(null),!u.trim()){l("Please enter your email");return}if(!h.trim()){l("Please enter your password");return}if(m.trim().toUpperCase()!==x.toUpperCase()){l("Invalid captcha. Please try again."),c();return}if(u==="aravind@gmail.com"&&h==="aravind@gmail.com"){localStorage.setItem("isLoggedIn","true"),localStorage.setItem("role","admin"),alert("Admin login successful!"),i("/admin"),window.location.reload();return}r(!0);try{const e=await y.post("/api/auth/login",{email:u.trim(),password:h.trim()});localStorage.setItem("isLoggedIn","true");const n=Array.isArray(e.data.user.roles)?e.data.user.roles[0]:e.data.user.roles;localStorage.setItem("role",n),localStorage.setItem("userPhone",e.data.user.phone),localStorage.setItem("user",JSON.stringify(e.data.user)),e.data.userId&&localStorage.setItem("userId",e.data.userId),alert(e.data.message),e.data.user.isFullyVerified?i("/"):e.data.user.needsVerification||!e.data.user.isFullyVerified?i("/verification"):i("/dashboard"),window.location.reload()}catch(e){alert(e?.response?.data?.message||"Login failed")}finally{r(!1)}};return a.jsx("div",{className:"lp-page",children:a.jsxs("div",{className:"lp-card",role:"main","aria-labelledby":"login-heading",children:[a.jsxs("div",{className:"lp-header",children:[a.jsxs("div",{children:[a.jsx("h1",{id:"login-heading",className:"lp-title",children:"Welcome back"}),a.jsx("p",{className:"lp-subtitle",children:"Sign in to continue to GeekyChat"})]}),a.jsx("div",{className:"lp-help",children:a.jsxs("small",{children:["Need help? ",a.jsx(j,{to:"/support",children:"Contact"})]})})]}),a.jsxs("div",{className:"lp-segment",role:"tablist","aria-label":"Login methods",children:[a.jsx("button",{className:`lp-seg-btn ${o==="password"?"active":""}`,onClick:()=>k("password"),role:"tab","aria-selected":o==="password","aria-controls":"password-panel",children:"Email & Password"}),a.jsx("button",{className:`lp-seg-btn ${o==="otp"?"active":""}`,onClick:()=>k("otp"),role:"tab","aria-selected":o==="otp","aria-controls":"otp-panel",children:"Phone & OTP"})]}),O&&a.jsx("div",{className:"lp-error",children:O}),o==="password"&&a.jsxs("section",{id:"password-panel","aria-labelledby":"email-login",className:"lp-panel",children:[a.jsx("label",{className:"lp-label",htmlFor:"email",children:"Email"}),a.jsx("div",{className:"lp-password-row",children:a.jsx("input",{id:"email",type:"email",className:"lp-input lp-input-password",placeholder:"you@company.com",value:u,onChange:e=>S(e.target.value),autoComplete:"email","aria-required":!0})}),a.jsx("label",{className:"lp-label",htmlFor:"password",children:"Password"}),a.jsxs("div",{className:"lp-password-row",children:[a.jsx("input",{id:"password",type:v?"text":"password",className:"lp-input lp-input-password",placeholder:"Your password",value:h,onChange:e=>C(e.target.value),autoComplete:"current-password","aria-required":!0}),a.jsx("button",{type:"button",onClick:()=>F(e=>!e),"aria-label":v?"Hide password":"Show password",className:"lp-icon-btn",children:v?"🙈":"👁️"})]}),a.jsx("label",{className:"lp-label",children:"Captcha"}),a.jsxs("div",{className:"lp-captcha-row",children:[a.jsx("div",{className:"lp-captcha-box","aria-hidden":!0,children:x}),a.jsx("button",{type:"button",onClick:c,className:"lp-btn-outline","aria-label":"Regenerate captcha",children:"↻"}),a.jsx("input",{type:"text",placeholder:"Enter captcha",value:m,onChange:e=>g(e.target.value),className:"lp-input lp-captcha-input"})]}),a.jsx("div",{className:"lp-actions",children:a.jsx("button",{className:"lp-btn-primary",onClick:$,disabled:t,"aria-busy":t,children:t?"Logging in…":"Login"})})]}),o==="otp"&&a.jsxs("section",{id:"otp-panel","aria-labelledby":"phone-login",className:"lp-panel",children:[a.jsx("label",{className:"lp-label",htmlFor:"phone",children:"Phone number"}),a.jsx("input",{id:"phone",type:"tel",className:"lp-input",placeholder:"+91 98765 43210",value:d,onChange:e=>w(e.target.value),disabled:I,"aria-required":!0}),I?a.jsxs(a.Fragment,{children:[a.jsx("label",{className:"lp-label",htmlFor:"otp",children:"Enter OTP"}),a.jsx("input",{id:"otp",type:"text",className:"lp-input",placeholder:"6-digit code",value:N,onChange:e=>P(e.target.value),maxLength:6,"aria-required":!0}),a.jsxs("div",{className:"lp-otp-row",children:[a.jsx("div",{className:"lp-muted",children:p>0?`Resend in ${R(p)}`:"Didn't receive the code?"}),p>0?null:a.jsx("button",{type:"button",onClick:V,className:"lp-btn-outline",disabled:t,children:t?"Sending…":"Resend OTP"})]}),a.jsx("div",{className:"lp-actions",children:a.jsx("button",{className:"lp-btn-primary",onClick:U,disabled:t,"aria-busy":t,children:t?"Verifying…":"Verify & Login"})})]}):a.jsxs(a.Fragment,{children:[a.jsx("label",{className:"lp-label",children:"Captcha"}),a.jsxs("div",{className:"lp-captcha-row",children:[a.jsx("div",{className:"lp-captcha-box","aria-hidden":!0,children:x}),a.jsx("button",{type:"button",onClick:c,className:"lp-btn-outline","aria-label":"Regenerate captcha",children:"↻"}),a.jsx("input",{type:"text",placeholder:"Enter captcha",value:m,onChange:e=>g(e.target.value),className:"lp-input lp-captcha-input"})]}),a.jsx("div",{className:"lp-actions",children:a.jsx("button",{className:"lp-btn-primary",onClick:M,disabled:t,"aria-busy":t,children:t?"Sending OTP…":"Send OTP"})})]})]}),a.jsxs("div",{className:"lp-footer",children:[a.jsxs("p",{className:"lp-footer-text",children:["Don't have an account? ",a.jsx(j,{to:"/register",className:"lp-register-link",children:"Register"})]}),a.jsxs("p",{className:"lp-small-note",children:["By continuing you agree to our ",a.jsx(j,{to:"/terms",children:"Terms"})," and ",a.jsx(j,{to:"/privacy",children:"Privacy Policy"}),"."]})]})]})})};export{D as default};
